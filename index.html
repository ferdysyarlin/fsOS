<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catatan Kinerja Harian</title>
    <script src="https://unpkg.com/vue@3"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; background-color: #f4f4f9; color: #333; }
        #app { max-width: 800px; margin: 40px auto; padding: 20px; background-color: #fff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1, h2 { color: #2c3e50; }
        hr { border: 0; height: 1px; background-color: #e0e0e0; margin: 20px 0; }
        form { display: flex; flex-direction: column; gap: 15px; }
        input, select, textarea, button { padding: 10px; border-radius: 5px; border: 1px solid #ccc; font-size: 16px; }
        textarea { resize: vertical; min-height: 80px; }
        button { background-color: #42b983; color: white; border: none; cursor: pointer; transition: background-color 0.3s; }
        button:hover { background-color: #34966b; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; border: 1px solid #ddd; text-align: left; }
        th { background-color: #f8f8f8; }
        .loading { text-align: center; color: #777; }
    </style>
</head>
<body>

<div id="app">
    <h1>üìù Catatan Kinerja Harian</h1>
    <hr>
    
    <h2>Tambah Aktivitas Baru</h2>
    <form @submit.prevent="addRecord">
        <input type="date" v-model="newRecord.tanggal" required>
        <textarea v-model="newRecord.aktivitas" placeholder="Deskripsi Aktivitas..." required></textarea>
        <select v-model="newRecord.status">
            <option>Selesai</option>
            <option>Dalam Proses</option>
            <option>Tertunda</option>
        </select>
        <button type="submit" :disabled="isSubmitting">
            {{ isSubmitting ? 'Menyimpan...' : 'Simpan' }}
        </button>
    </form>
    
    <hr>

    <h2>Riwayat Aktivitas</h2>
    <div v-if="isLoading" class="loading">Memuat data...</div>
    <table v-else-if="records.length > 0">
        <thead>
            <tr>
                <th>Tanggal</th>
                <th>Aktivitas</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            <tr v-for="record in records" :key="record.rowIndex">
                <td>{{ record.Tanggal }}</td>
                <td>{{ record.Aktivitas }}</td>
                <td>{{ record.Status }}</td>
            </tr>
        </tbody>
    </table>
    <div v-else>Belum ada data untuk ditampilkan.</div>
</div>

<script>
    const { createApp } = Vue;

    createApp({
        data() {
            return {
                // PENTING: Ganti dengan URL Web App dari Google Apps Script Anda!
                gasUrl: 'GANTI_DENGAN_URL_WEB_APP_ANDA',
                isLoading: true,
                isSubmitting: false,
                records: [],
                newRecord: {
                    tanggal: new Date().toISOString().slice(0, 10),
                    aktivitas: '',
                    status: 'Selesai'
                }
            }
        },
        methods: {
            async fetchRecords() {
                this.isLoading = true;
                try {
                    const response = await fetch(this.gasUrl);
                    if (!response.ok) throw new Error('Gagal mengambil data!');
                    this.records = await response.json();
                } catch (error) {
                    console.error("Error fetching records:", error);
                    alert('Tidak dapat memuat data dari Google Sheet.');
                } finally {
                    this.isLoading = false;
                }
            },
            async addRecord() {
                if (!this.newRecord.tanggal || !this.newRecord.aktivitas) {
                    alert('Tanggal dan Aktivitas tidak boleh kosong.');
                    return;
                }
                this.isSubmitting = true;
                try {
                    const response = await fetch(this.gasUrl, {
                        method: 'POST',
                        body: JSON.stringify(this.newRecord),
                        headers: {
                            'Content-Type': 'text/plain;charset=utf-8', // GAS menerima body sebagai plain text
                        }
                    });
                    const result = await response.json();
                    if (result.status === 'success') {
                        // Reset form
                        this.newRecord.aktivitas = '';
                        // Muat ulang data untuk menampilkan data terbaru
                        this.fetchRecords(); 
                    } else {
                        throw new Error(result.message);
                    }
                } catch (error) {
                    console.error("Error adding record:", error);
                    alert('Gagal menyimpan data baru.');
                } finally {
                    this.isSubmitting = false;
                }
            }
        },
        mounted() {
            // Panggil fungsi untuk mengambil data saat komponen pertama kali dimuat
            this.fetchRecords();
        }
    }).mount('#app');
</script>

</body>
</html>
